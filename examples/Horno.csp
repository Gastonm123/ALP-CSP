{- El horno microondas posee un panel de control semejante a algunos modelos populares.
Los botones numerados del 1 al 4 se utilizan para fijar la potencia de coccion. La perilla
circular puede girar en ambos sentidos y sirve para fijar el tiempo de coccion: si lo hace
en sentido horario aumenta el tiempo de a 5 segundos, en el sentido contrario disminuye
en la misma cantidad.
Normalmente, en el display se muestra la hora actual pero cuando se fija el tiempo
de coccion se la reemplaza por el tiempo que el usuario selecciona a medida que hace
girar la perilla. Una vez que detiene la perilla, debe seleccionar una de las potencias
de coccion y finalmente pulsar el boton Start. Al hacerlo la puerta debe estar cerrada
y en el display se comienza a decrementar el tiempo de a un segundo.
- Si se pulsa Stop se borra el tiempo de coccion, se resetea la seleccion de la potencia
y se vuelve a mostrar la hora.
- Si durante la coccion se abre la puerta, se detiene el tiempo de coccion y si se
vuelve a cerrar se debera pulsar Start nuevamente para continuar la coccion desde
el punto donde se la abandono.
- Se puede cambiar la potencia de coccion mientras se esta cocinando.
- Si durante la coccion el usuario hace girar la perilla, el tiempo de coccion debe
actualizarse.
La coccion se detendra automaticamente cuando el tiempo llegue a cero, luego de lo
cual se volvera a mostrar la hora y se reseteara la potencia seleccionada.
-}

TEMPORIZADOR.0 = temporizador.0 -> final_temporizador -> TEMPORIZADOR_PARADO.0
TEMPORIZADOR.1 = temporizador.1 -> 
                (tick -> TEMPORIZADOR.0
                | disminuir_tiempo.5 -> TEMPORIZADOR.0
                | aumentar_tiempo.5 -> TEMPORIZADOR.(t+5)
                | stop -> TEMPORIZADOR_PARADO.0)
TEMPORIZADOR.2 = temporizador.2 -> 
                (tick -> disminuir_tiempo.1 -> TEMPORIZADOR.1
                | disminuir_tiempo.5 -> TEMPORIZADOR.0
                | aumentar_tiempo.5 -> TEMPORIZADOR.(t+5)
                | stop -> TEMPORIZADOR_PARADO.0))
TEMPORIZADOR.3 = temporizador.3 ->
                (tick -> disminuir_tiempo.1 -> TEMPORIZADOR.2
                | disminuir_tiempo.5 -> TEMPORIZADOR.0
                | aumentar_tiempo.5 -> TEMPORIZADOR.(t+5)
                | stop -> TEMPORIZADOR_PARADO.0))  
TEMPORIZADOR.4 = temporizador.4 ->
                (tick -> disminuir_tiempo.1 -> TEMPORIZADOR.3
                | disminuir_tiempo.5 -> TEMPORIZADOR.0
                | aumentar_tiempo.5 -> TEMPORIZADOR.(t+5)
                | stop -> TEMPORIZADOR_PARADO.0))
TEMPORIZADOR.t = temporizador.t ->
                (tick -> disminuir_tiempo.1 -> TEMPORIZADOR.(t-1)
                | aumentar_tiempo.5 -> TEMPORIZADOR.(t+5)
                | disminuir_tiempo.5 -> TEMPORIZADOR.(t-5)
                | stop -> TEMPORIZADOR_PARADO.0))
TEMPORIZADOR.(t+121) = TEMPORIZADOR.120 -- no seguir infinitamente

TEMPORIZADOR_PARADO.0
    = config_temporizador.0 ->
    ( aumentar_tiempo.5 -> TEMPORIZADOR_PARADO.5
    | disminuir_tiempo.5 -> TEMPORIZADOR_PARADO.0
    | get_time!0 -> TEMPORIZADOR_PARADO.0
    | start -> TEMPORIZADOR_PARADO.0   -- ignore
    | stop -> TEMPORIZADOR_PARADO.0)   -- ignore
TEMPORIZADOR_PARADO.t
    = config_temporizador.t ->
    ( aumentar_tiempo.5 -> TEMPORIZADOR_PARADO.(t+5)
    | disminuir_tiempo.5 -> TEMPORIZADOR_PARADO.(t-5)
    | get_time!t -> TEMPORIZADOR_PARADO.t
    | start -> TEMPORIZADOR.t
    | stop -> TEMPORIZADOR_PARADO.0)
TEMPORIZADOR_PARADO.(t+121) = TEMPORIZADOR_PARADO.120  -- no seguir infinitamente

DK_PERILLA = giro_horario -> aumentar_tiempo -> DK_PERILLA |
          giro_antihorario -> disminuir_tiempo -> DK_PERILLA

DK_START = press_start -> (start -> DK_START | beep -> DK_START)

-- hora_actual ~ el display empieza a mostrar la hora actual
-- display_tiempo.i ~ el display muestra que el temporizador con i segundos
DISPLAY   = hora_actual -> temporizador.t -> DISPLAY.t
DISPLAY.t = display_tiempo.t -> 
    ( temporizador.k -> DISPLAY.k
    | final_temporizador -> DISPLAY
    | stop -> DISPLAY)

-- Hay 4 botones de potencia
DK_POTENCIA.i = boton_potencia.i -> (potencia.i -> DK_POTENCIA.i [] DK_POTENCIA.i)
DK_POTENCIAS = DK_POTENCIA.1 || DK_POTENCIA.2 || DK_POTENCIA.3 || DK_POTENCIA.4

START = press_start -> get_time?v -> START.1.v
START.1.0     = beep  -> START
START.1.(t+1) = start -> START.2
START.2 = final_temporizador -> START
        | stop -> START
        | press_start -> START.2 -- ignore

-- PUERTA.0 ~ la puerta esta abierta, PUERTA.1 ~ la puerta esta cerrada
PUERTA.0 = puerta_cerrada -> PUERTA.0
PUERTA.1 = start -> PUERTA.1 | puerta_abierta -> PUERTA.0

POTENCIAS.0     = potencia.i -> POTENCIAS.i
POTENCIAS.(p+1) = potencia.i -> POTENCIAS.i
    | start ->
        ( final_temporizador -> POTENCIAS.0
        | stop -> POTENCIAS.0)

DK_STOP = press_stop -> stop -> DK_STOP